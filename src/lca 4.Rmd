```{r}
data <- read.csv("diabetes_012_health_indicators_BRFSS2015.csv")

library(dplyr)
data_bad_MH <- data |> 
  filter(MentHlth > 15) # Focus on groups with poor mental health

data_no_HC <- data_bad_MH |> 
  filter(AnyHealthcare == 1) |> 
  select(-AnyHealthcare)# Compare with having HC

data_HC <- data_bad_MH |> 
  filter(AnyHealthcare == 0) |> 
  select(-AnyHealthcare)
```

```{r}
# test 2: no HC
# Note: Change the data for different tests (i.e. HC and no HC)


# Load library
library(poLCA)

# Binning process
data_no_HC$BMI <- ifelse(data_no_HC$BMI >= 18 & data_no_HC$BMI <= 25, 1, 0)
data_no_HC$GenHlth <- ifelse(data_no_HC$GenHlth %in% 1:3, 1, 0)
data_no_HC$PhysHlth <- ifelse(data_no_HC$PhysHlth < 15, 1, 0)

# Exclude specific columns
excluded_columns <- c("MentHlth", "Sex", "Age", "Income", "Education")
selected_columns <- setdiff(colnames(data_no_HC), excluded_columns)

# Select variables for LCA (categorical or ordinal variables only)
lca_data <- data_no_HC[, selected_columns]

# Ensure all variables are treated as factors
lca_data <- lapply(lca_data, as.factor)
lca_data <- as.data.frame(lca_data)

# Run LCA for 3 classes
set.seed(123)
optimal_classes <- 5
lca_model <- poLCA(cbind(HighBP, HighChol, CholCheck, Smoker, Stroke, HeartDiseaseorAttack, 
                         PhysActivity, Fruits, Veggies, HvyAlcoholConsump, NoDocbcCost, 
                         GenHlth, DiffWalk, BMI, PhysHlth) ~ 1, 
                   data = lca_data, nclass = optimal_classes, 
                   maxiter = 1000, nrep = 10, verbose = TRUE)

# Summarize the model
summary(lca_model)

```


```{r}
# PCA, already ran this, no further need for now

# Load necessary libraries
library(ggplot2)

# Load the data (update the file path as needed)
data <- data_no_HC

# Exclude specified variables
excluded_vars <- c("BMI", "MentHlth", "PhysHlth", "Sex", "Age", "Income", "Education")
filtered_data <- data[, !(names(data) %in% excluded_vars)]

# Select numeric columns for PCA
numeric_data <- filtered_data[sapply(filtered_data, is.numeric)]

# Perform PCA
pca_result <- prcomp(numeric_data, center = TRUE, scale. = TRUE)

# Scree Plot
explained_variance <- pca_result$sdev^2 / sum(pca_result$sdev^2) * 100
scree_plot <- data.frame(Principal_Component = 1:length(explained_variance),
                         Variance_Explained = explained_variance)

# Create Scree Plot
ggplot(scree_plot, aes(x = Principal_Component, y = Variance_Explained)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  geom_line(aes(group = 1), color = "red") +
  geom_point(color = "red") +
  labs(title = "Scree Plot (Excluding Specified Variables)", 
       x = "Principal Component", 
       y = "Variance Explained (%)") +
  theme_minimal()

```

